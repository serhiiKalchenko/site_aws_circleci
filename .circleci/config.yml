version: 2.1

orbs:
  aws-cli: circleci/aws-cli@1.3.0

jobs:
  build:
    machine:
      image: ubuntu-2004:202010-01
    steps:
      - checkout
      
      - run:
          name: Where am I?
          command: |
            pwd
            ls -lah
            whoami
  
      - run:
          name: Creating a packages (archives)
          command: |
            mkdir packages
            cd joomla-data
            sudo tar -cpjf ../packages/joomla-data.tar.bz2 .
            echo "folder 'packages':"
            ls -l ../packages
            cd ../db-data
            sudo tar -cpjf ../packages/db-data.tar.bz2 .
            echo "folder 'packages':"
            ls -l ../packages

      - run:
          name: Connecting to AWS EC2 instance...
          command: |
            aws --version
            scp -r packages dockeradmin@ec2-18-216-111-124.us-east-2.compute.amazonaws.com:~

